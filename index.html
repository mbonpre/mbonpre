<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Surprise ❤️ — Scannez le QR</title>
    <style>
        :root{--overlay: rgba(0,0,0,0.45);--accent: #ffd1dc}
        *{box-sizing:border-box}
        html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
        .wrap{position:relative;height:100vh;overflow:hidden;background:#000}
        
        /* Image de fond unique (Simplifiée) */
        .single-background{
            position:absolute;
            inset:0;
            background-image: url('im/photo1.jpg'); /* Chemin im/ minuscule */
            background-size:cover;
            background-position:center;
            opacity:1;
            transition:opacity 0.5s ease;
        }

        /* calque sombre + contenu */
        .overlay{position:absolute;inset:0;background:var(--overlay);display:flex;align-items:center;justify-content:center;padding:20px}
        .card{max-width:860px;width:100%;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));border-radius:16px;padding:28px;color:white;backdrop-filter: blur(6px);box-shadow:0 8px 30px rgba(0,0,0,0.5)}

        .top-row{display:flex;align-items:center;gap:12px}
        .avatar{width:64px;height:64px;border-radius:50%;overflow:hidden;flex:0 0 64px;border:2px solid rgba(255,255,255,0.12)}
        .avatar img{width:100%;height:100%;object-fit:cover}
        .title{font-size:18px;margin:0}
        .subtitle{font-size:13px;opacity:0.85}

        .message-box{margin-top:18px;min-height:90px;font-size:20px;line-height:1.3}
        .typing{display:inline-block;white-space:pre-wrap}

        .controls{display:flex;align-items:center;gap:10px;margin-top:18px}
        .btn{padding:9px 12px;border-radius:10px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.06);cursor:pointer}
        .progress{flex:1;height:8px;background:rgba(255,255,255,0.08);border-radius:6px;overflow:hidden}
        .fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#ff9bbf);transition:width 0.15s}

        .small{font-size:13px;opacity:0.9;margin-top:10px}

        /* responsive */
        @media (max-width:600px){.card{padding:18px}.message-box{font-size:17px}}

        /* subtle cue for QR printing area */
        .qr-note{margin-top:14px;font-size:13px;opacity:0.9}

        /* fade in animation for card */
        .card{transform:translateY(6px);opacity:0;animation:pop 0.6s forwards 0.4s}
        @keyframes pop{to{transform:none;opacity:1}}
    </style>
</head>
<body>
    <div class="wrap">
        <div class="single-background" id="background"></div>

        <div class="overlay">
            <div class="card">
                <div class="top-row">
                    <div class="avatar"><img id="avatarImg" src="im/photo1.jpg" alt="avatar"></div> 
                    <div>
                        <h3 class="title" id="cardTitle">Pour toi ❤️</h3>
                        <div class="subtitle" id="cardSubtitle">Scanne ce QR pour une surprise</div>
                    </div>
                </div>

                <div class="message-box">
                    <span class="typing" id="typing"></span><span id="cursor">▌</span>
                </div>

                <div class="controls">
                    <button class="btn" id="playBtn">▶️ Play</button>
                    <button class="btn" id="pauseBtn">⏸️ Pause</button>
                    <div class="progress" id="progress"><div class="fill" id="fill"></div></div>
                    <div class="small" id="time">0:00</div>
                </div>

                <div class="small qr-note">Conseil : quand tu imprimes/graves le QR sur le bracelet, fais en sorte qu'il pointe vers l'URL publique de cette page.</div>

            </div>
        </div>

        <audio id="bgAudio" preload="none" src="audio/song.mp3"></audio>
    </div>

    <script>
        /* --- Messages synchronisés à la musique --- */
        const messages = [
            {at: 0, text: "Mon amour, cette petite surprise est entièrement dédiée à toi."},
            {at: 6, text: "Depuis que nos chemins se sont croisés, ma vie est un poème."},
            {at: 14, text: "Tu es ma lumière, celle qui me guide et m'inspire chaque jour."},
            {at: 23, text: "Chaque rire, chaque silence à tes côtés est un trésor inestimable."},
            {at: 35, text: "Je t'aime plus que les mots ne peuvent le dire."},
            {at: 45, text: "Merci d'être toi, ma moitié parfaite. Pour aujourd'hui et pour toujours. ❤️"}
        ];
        
        // audio & controls
        const audio = document.getElementById('bgAudio');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const typingEl = document.getElementById('typing');
        const cursor = document.getElementById('cursor');
        const fill = document.getElementById('fill');
        const timeEl = document.getElementById('time');
        const backgroundEl = document.getElementById('background'); 

        let shownIndex = -1; 
        let typingTimer = null;
        let showLaunched = false; 

        function formatTime(s){
            const m = Math.floor(s/60); const sec = Math.floor(s%60).toString().padStart(2,'0');
            return m+':'+sec;
        }

        // Écouteur PLAY : Gère le lancement initial
        playBtn.addEventListener('click', ()=>{ 
            audio.play(); 

            // Lance le premier message UNIQUEMENT la première fois
            if (showLaunched === false) {
                // Afficher immédiatement le premier message (at: 0)
                if(messages.length > 0) {
                    shownIndex = 0;
                    typeText(messages[0].text);
                }
                showLaunched = true;
            } 
            
            // Désactiver le bouton Play une fois que la musique joue
            playBtn.disabled = true; 
            playBtn.style.opacity = '0.5'; 
            
        });

        // Écouteur PAUSE : Gère l'arrêt et la réactivation de Play
        pauseBtn.addEventListener('click', ()=>{ 
            audio.pause(); 
            
            // Rendre le bouton Play utilisable après une pause
            playBtn.disabled = false; 
            playBtn.style.opacity = '1'; 
        });

        // mise à jour progress et messages
        audio.addEventListener('timeupdate', ()=>{
            const pct = (audio.currentTime / audio.duration) || 0;
            fill.style.width = (pct*100) + '%';
            timeEl.textContent = formatTime(audio.currentTime);

            // check messages
            for(let i=0;i<messages.length;i++){
                if(audio.currentTime >= messages[i].at && shownIndex < i){
                    shownIndex = i;
                    typeText(messages[i].text);
                }
            }
        });

        audio.addEventListener('ended', ()=>{ cursor.style.opacity='0'; });

        // typing effect
        function typeText(text){
            if(typingTimer) clearInterval(typingTimer);
            typingEl.textContent = '';
            cursor.style.opacity = '1';
            let idx = 0;
            typingTimer = setInterval(()=>{
                typingEl.textContent += text.charAt(idx);
                idx++;
                if(idx >= text.length){
                    clearInterval(typingTimer);
                    typingTimer = null;
                    let blink = 0;
                    const b = setInterval(()=>{ cursor.style.visibility = (cursor.style.visibility === 'hidden' ? 'visible' : 'hidden'); if(++blink>6){ clearInterval(b); cursor.style.visibility='visible'; } }, 300);
                }
            }, 45);
        }
        
        // Initialiser l'affichage de l'image (pour s'assurer qu'elle est visible au chargement)
        document.addEventListener('DOMContentLoaded', () => {
            backgroundEl.style.opacity = '1';
        });

    </script>
</body>
</html>
